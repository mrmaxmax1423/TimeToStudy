<!DOCTYPE html>
@model EventViewModel
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        border: 1px solid black;
        padding: 10px;
        text-align: center;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

</style>
<html>
<head>
    <title>Weekly Calendar</title>

</head>
<body>

    <h1>Weekly Calendar</h1>
    <div>
        <div>
            <button type="submit" class="btn btn-primary btn-sm" button id="prev-week-btn">Previous Week</button>
            <button type="submit" class="btn btn-primary btn-sm" button id="current-week-btn"> Go to current Week </button>
            <button type="submit" class="btn btn-primary btn-sm" button id="next-week-btn">Next Week</button>

        </div>
        <br />
        <h2 class="week-label" id="DateLabel">
            @Model.SelectedDate.ToString("MM/dd/yyyy")
        </h2>

        <table>
            <tr>
                <th></th>
                @for (int day = 0; day < 7; day++)
                {//Needs modification to support changing what week is displayed
                    var currentDate = Model.SelectedDate.AddDays(day);

                    <th>@currentDate.ToString("dddd, MMMM d")</th>
                }
            </tr>

            @for (int hour = 0; hour < 24; hour++)
            {
                <tr>
                    <td>@hour:00</td>
                    @for (int day = 0; day < 7; day++)
                    {
                        //Finds day stored in model (defaults to today if no date is passed, like on initial load), adds one day for every loop
                        var currentDate = Model.SelectedDate.AddDays(day);
                        //System.Console.WriteLine(currentDate);
                <td>
                    @foreach (Event E in Model.Events.Where(e => e.EventTime.Value.Date == currentDate && e.EventTime.Value.Hour == hour))
                    {
                        <div>@E.EventLabel</div>
                        <div style="font-size: 12px;"> @E.EventDescription </div>
                        <div>@E.EventTime.Value.ToString("HH:mm") - @E.EventTime.Value.AddHours(E.EventLength).ToString("HH:mm")</div>
                    }
                </td>
                    }
                </tr>
            }
        </table>

        <script>
            //links buttons to html buttons
            var prevWeekBtn = document.getElementById('prev-week-btn');
            var nextWeekBtn = document.getElementById('next-week-btn');
            var currentWeekBtn = document.getElementById('current-week-btn');

            //links a new variable to the date label (Holds the currently date passed by the calendar method in EventController)
            const dateText = document.getElementById('DateLabel');
            const currentDate = new Date(dateText.textContent);

            // Attach event listeners to the buttons
            prevWeekBtn.addEventListener('click', function () {
                // set the date to the previous week
                var prevWeekDate = new Date(currentDate);
                prevWeekDate.setDate(prevWeekDate.getDate() - 7);
                prevWeekDate.setHours(0, 0, 0, 0); //start at midnight 
                // Redirect to the page for the previous week
                window.location.href = '/Event/Calendar?date=' + prevWeekDate.toISOString();
            });

            nextWeekBtn.addEventListener('click', function () {
                //sets the date to the next week
                var nextWeekDate = new Date(currentDate);
                nextWeekDate.setDate(nextWeekDate.getDate() + 7);
                nextWeekDate.setHours(0, 0, 0, 0) //start at midnight 

                // Redirect to the page for the next week
                window.location.href = '/Event/Calendar?date=' + nextWeekDate.toISOString();
            });

            currentWeekBtn.addEventListener('click', function () {
                //Finds the current date
                var currentDate = new Date();
                currentDate.setHours(0, 0, 0, 0) //start at midnight

                // Redirect to the page for the next week

                window.location.href = '/Event/Calendar?date=' + currentDate.toISOString();
            });


        </script>

    </div>
</body>
</html>